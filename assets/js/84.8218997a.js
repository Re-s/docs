(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{687:function(e,v,_){"use strict";_.r(v);var t=_(46),r=Object(t.a)({},(function(){var e=this,v=e.$createElement,_=e._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("p",[_("strong",[e._v("简  述：")]),e._v("　在制作控制中心插件前,您必须学习Qt的插件机制,方能写出合格稳定的插件库,如果你在看本篇文章前还未看过Qt的应用程序插件编写规则,")]),e._v(" "),_("p",[e._v("建议你在先阅读一下链接的文档:https://blog.51cto.com/9291927/2107320")]),e._v(" "),_("br"),e._v(" "),_("p",[e._v("[TOC]")]),e._v(" "),_("br"),e._v("\n**编写前的准备**\n"),_("p",[e._v("在shuttle上下载安装插件开发库:dde-control-center-dev_5.3.0.85-1_amd64.deb")]),e._v(" "),_("p",[e._v("安装之后在本地目录/usr/include/dde-control-center中就会多了两个文件夹interface和widgets.")]),e._v(" "),_("p",[e._v("interface为插件基类;widgets为控制中心一些封装的UI库,你可以引用.")]),e._v(" "),_("br"),e._v(" "),_("h2",{attrs:{id:"一-控制中心一级插件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#一-控制中心一级插件"}},[e._v("#")]),e._v(" "),_("strong",[e._v("一.控制中心一级插件")])]),e._v(" "),_("p",[e._v("1,继承于Object类和ModuleInterface类,重写ModuleInterface所有的虚函数,需要声明两个宏指定为插件")]),e._v(" "),_("ul",[_("li",[e._v("Q_PLUGIN_METADATA(IID ModuleInterface_iid)")]),e._v(" "),_("li",[e._v("Q_INTERFACES(DCC_NAMESPACE::ModuleInterface)")])]),e._v(" "),_("p",[e._v("2,其中重载的虚函数列表如下:")]),e._v(" "),_("ul",[_("li",[e._v("QIcon "),_("em",[e._v("icon")]),e._v("() const override; //指定图标")]),e._v(" "),_("li",[e._v("virtual void "),_("em",[e._v("preInitialize")]),e._v("(bool sync = false , FrameProxyInterface::PushType = FrameProxyInterface::PushType::Normal) override;")]),e._v(" "),_("li",[e._v("virtual void "),_("em",[e._v("initialize")]),e._v("() override;")]),e._v(" "),_("li",[e._v("virtual const QString "),_("em",[e._v("name")]),e._v('() const override; // 插件名字,例:return QStringLiteral("privacy"); 按照标准小写,此名字关系Gsetting配置')]),e._v(" "),_("li",[e._v("virtual const QString "),_("em",[e._v("displayName")]),e._v('() const override; // 可添加翻译文件,显示插件名称,例:return tr("Privacy");')]),e._v(" "),_("li",[e._v("virtual void "),_("em",[e._v("active")]),e._v("() override; // 激活逻辑处理函数")]),e._v(" "),_("li",[e._v("virtual int "),_("em",[e._v("load")]),e._v("(const QString &path) override;")]),e._v(" "),_("li",[e._v("QStringList "),_("em",[e._v("availPage")]),e._v("() const override;")]),e._v(" "),_("li",[e._v("QString "),_("em",[e._v("translationPath")]),e._v("() const override;")]),e._v(" "),_("li",[e._v("void "),_("em",[e._v("deactive")]),e._v("() override;")]),e._v(" "),_("li",[e._v("void "),_("em",[e._v("contentPopped")]),e._v("(QWidget *const w) override;")]),e._v(" "),_("li",[e._v("void "),_("em",[e._v("reset")]),e._v("() override;")])]),e._v(" "),_("br"),e._v(" "),_("p",[e._v("3,翻译文件处理,插件类中可以实现自己的翻译文件,举例插件名称Privacy,此时翻译文件按标准可以存在/usr/share/Privacy/translations")]),e._v(" "),_("p",[e._v("4,编译插件库,将生成的so文件拷贝到控制中心的插件库目录/usr/lib/dde-control-center/modules/")]),e._v(" "),_("p",[e._v('5,配置Gsettings配置:/com/deepin/dde/control-center/plugin-setting,在配置此key时,你会发现默认存在一个json配置{"mainwindow":{"voice":{"enable":true,"index":"keyboard","maxmenu":3}},这是辅助功能一级插件的配置')]),e._v(" "),_("p",[e._v("mainwindow代表他是一级控件,keyboard代表此一级插件位置在键盘和语言后面.voice代表此插件名称,对应virtual const QString "),_("em",[e._v("name")]),e._v("() const override这个返回值,由开发者自定义(注意不要重名)")]),e._v(" "),_("p",[e._v('示例:将自定义的隐私插件放在一级模块通用后面json配置:{"mainwindow": {"voice": {"enable": true,"index": "keyboard","maxmenu": 3},"privacy": {"enable": true,"index": "commoninfo","maxmenu": 3}}}')]),e._v(" "),_("p",[e._v("6,dde-control-center -s 运行控制中心查看效果:")]),e._v(" "),_("br"),e._v(" "),_("p",[_("a",{attrs:{href:"https://wikidev.uniontech.com/index.php?title=%E6%96%87%E4%BB%B6:Control-center_First_level_plug-in.png",target:"_blank",rel:"noopener noreferrer"}},[_("img",{attrs:{src:"https://wikidev.uniontech.com/images/0/0a/Control-center_First_level_plug-in.png",alt:"img"}}),_("OutboundLink")],1)]),e._v(" "),_("br"),e._v(" "),_("h2",{attrs:{id:"二-控制中心二级插件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#二-控制中心二级插件"}},[e._v("#")]),e._v(" "),_("strong",[e._v("二.控制中心二级插件")])]),e._v(" "),_("p",[e._v("1,二级插件的代码编写和一级插件基本一致,唯一需要注意的时在ModuleInterface类时,重载virtual void "),_("em",[e._v("active")]),e._v("() override; 时需要声明为public Q_SLOTS:")]),e._v(" "),_("p",[e._v('2,二级插件的Gseting配置: {"mainwindow": {"voice": {"enable": true,"index": "keyboard","maxmenu": 3},"privacy": {"enable": true,"index": "commoninfo","maxmenu": 3}},"Power":{"batteryhealth":{"enable": true,"index": 3,"maxmenu": 3}}}')]),e._v(" "),_("p",[e._v("其中的Power代表将此二级插件加入到电源管理模块,index为3表示将这个二级模块的位置放在电源管理二级模块最下面.")]),e._v(" "),_("p",[e._v("Json格式示范(此处包含了加载辅助功能 隐私一级插件和电池健康二级插件,):")]),e._v(" "),_("p",[e._v("{")]),e._v(" "),_("p",[_("strong",[e._v('"mainwindow"')]),e._v(":{")]),e._v(" "),_("p",[e._v("​    "),_("strong",[e._v('"voice"')]),e._v(":{")]),e._v(" "),_("p",[e._v("​      "),_("strong",[e._v('"enable"')]),e._v(":"),_("strong",[e._v("true")]),e._v(",")]),e._v(" "),_("p",[e._v("​      "),_("strong",[e._v('"index"')]),e._v(":"),_("strong",[e._v('"keyboard"')]),e._v(",")]),e._v(" "),_("p",[e._v("​      "),_("strong",[e._v('"maxmenu"')]),e._v(":"),_("strong",[e._v("3")])]),e._v(" "),_("p",[e._v("​    },")]),e._v(" "),_("p",[e._v("​    "),_("strong",[e._v('"privacy"')]),e._v(":{")]),e._v(" "),_("p",[e._v("​      "),_("strong",[e._v('"enable"')]),e._v(":"),_("strong",[e._v("true")]),e._v(",")]),e._v(" "),_("p",[e._v("​      "),_("strong",[e._v('"index"')]),e._v(":"),_("strong",[e._v('"commoninfo"')]),e._v(",")]),e._v(" "),_("p",[e._v("​      "),_("strong",[e._v('"maxmenu"')]),e._v(":"),_("strong",[e._v("3")])]),e._v(" "),_("p",[e._v("​    }")]),e._v(" "),_("p",[e._v("},")]),e._v(" "),_("p",[_("strong",[e._v('"Power"')]),e._v(":{")]),e._v(" "),_("p",[e._v("​    "),_("strong",[e._v('"batteryhealth"')]),e._v(":{")]),e._v(" "),_("p",[e._v("​      "),_("strong",[e._v('"enable"')]),e._v(":"),_("strong",[e._v("true")]),e._v(",")]),e._v(" "),_("p",[e._v("​      "),_("strong",[e._v('"index"')]),e._v(":"),_("strong",[e._v("3")]),e._v(",")]),e._v(" "),_("p",[e._v("​      "),_("strong",[e._v('"maxmenu"')]),e._v(":"),_("strong",[e._v("3")])]),e._v(" "),_("p",[e._v("​    }")]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("3,二级插件电池健康(BatteryHealth)示例效果:")]),e._v(" "),_("p",[_("a",{attrs:{href:"https://wikidev.uniontech.com/index.php?title=%E6%96%87%E4%BB%B6:Control-center_second_level_plug-in.png",target:"_blank",rel:"noopener noreferrer"}},[_("img",{attrs:{src:"https://wikidev.uniontech.com/images/b/bb/Control-center_second_level_plug-in.png",alt:"img"}}),_("OutboundLink")],1)]),e._v(" "),_("br"),e._v(" "),_("h2",{attrs:{id:"三-总结"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#三-总结"}},[e._v("#")]),e._v(" "),_("strong",[e._v("三.总结")])]),e._v(" "),_("p",[e._v("控制中心插件示例代码,已上传到uos分支.参考代码位置:")]),e._v(" "),_("p",[e._v("一级插件:/dde-control-center/src/frame/plugins/privacy")]),e._v(" "),_("p",[e._v("二级插件:/dde-control-center/src/frame/plugins/battery-health")])])}),[],!1,null,null,null);v.default=r.exports}}]);